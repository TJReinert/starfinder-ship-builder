/*! starfinder-ship-builder 2023-06-25 */

var JSON_FILE="data/ship-builder.json",WEAPON_SORT={forwardArc:0,portArc:1,starboardArc:2,aftArc:3,turret:4,spinal:5},WEAPON_ARCS=["forward","aft","port","starboard"];function maybeCreateProperty(e,s,t){if("object"!=typeof e)throw"Not an object";if(void 0===e[s])switch(t){case"Array":e[s]=[];break;case"String":e[s]="";break;case"Integer":e[s]=0;break;case"Object":default:e[s]={}}}function isset(e){return void 0!==e}function cloneObject(e){return JSON.parse(JSON.stringify(e))}function integerToWord(e){var s="";switch(e){case 1:s="one";break;case 2:s="two";break;case 3:s="three";break;case 4:s="four";break;case 5:s="five";break;case 6:s="six";break;case 7:s="seven";break;case 8:s="eight";break;case 9:s="nine";break;case 10:s="ten";break;default:s="error"}return s}function stringToFloat(e){if(parseInt(e)===e)return e;var s=e.split("/");return 1!=s.length&&2!=s.length?1:NaN===parseInt(s[0])||NaN===parseInt(s[1])?1:1==s.length?parseFloat(s[0]):1==s[2]?1:parseInt(s[0])/parseInt(s[1])}function stringToDice(e){if("Special"==e)return"Special";var s={ctDice:0,ctFaces:0,mod:0,mult:1};if("n/a"==e)return s;var t=e.split("×");2==t.length&&(s.mult=parseInt(t[1]));var i=e.split("+");2==i.length&&(s.mod=parseInt(i[1]));var r=e.split("d");return 2!=r.length?"error":(s.ctDice=parseInt(r[0]),s.ctFaces=parseInt(r[1]),s)}function loadJSON(e,s){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0),t.onreadystatechange=function(){4==t.readyState&&"200"==t.status&&s(t.responseText)},t.send(null)}function addTimedClass(e,s,t){addClass(e,s),setTimeout(function(){removeClass(e,s)},t)}function addClass(e,s){e.className+=" "+s}function removeClass(e,s){e.className=e.className.replace(s,"")}function isEven(e){return e%2==0}String.prototype.pluralise=function(e){return this+(1==e?"":"s")},String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};var clipboardJson={};function Ship(e){this.app=new Vue({el:"#app",data:{data:e,json:"",params:{},paramsReset:{ablativeArmorId:"none",ablativeArmorByPosition:{forward:0,aft:0,port:0,starboard:0},antiHackingSystemsId:"none",antiPersonnelWeaponId:"none",armorId:"none",armorMaterialId:"none",computerCountermeasures:{alarm:!1,fakeShell:!1,feedback:!1,firewall:!1,lockout:!1,shockGridId:"none",wipe:!1},computerId:"basic-computer",crewQuartersId:"common",crewSkills:{captain:{countOfficers:0,hasRole:!0,skills:{bluff:{modifier:0,ranks:0},computers:{modifier:0,ranks:0},diplomacy:{modifier:0,ranks:0},engineering:{modifier:0,ranks:0},gunnery:{modifier:0},intimidate:{modifier:0,ranks:0},perception:{modifier:0,ranks:0},piloting:{modifier:0,ranks:0}}},engineer:{countOfficers:1,countOfficerCrew:0,hasRole:!0,skills:{computers:{modifier:0,ranks:0},engineering:{modifier:0,ranks:0}}},gunner:{countOfficers:1,countOfficerCrew:0,hasRole:!0,skills:{computers:{modifier:0,ranks:0},engineering:{modifier:0,ranks:0},gunnery:{modifier:0}}},pilot:{countOfficers:1,countOfficerCrew:0,hasRole:!0,skills:{computers:{modifier:0,ranks:0},diplomacy:{modifier:0,ranks:0},engineering:{modifier:0,ranks:0},gunnery:{modifier:0},intimidate:{modifier:0,ranks:0},piloting:{modifier:0,ranks:0}}},scienceOfficer:{countOfficers:1,countOfficerCrew:0,hasRole:!0,skills:{computers:{modifier:0,ranks:0},"life-science":{modifier:0,ranks:0},"physical-science":{modifier:0,ranks:0}}},chiefMate:{countOfficers:1,countOfficerCrew:0,hasRole:!1,skills:{acrobatics:{modifier:0,ranks:0},athletics:{modifier:0,ranks:0}}},magicOfficer:{countOfficers:1,countOfficerCrew:0,hasRole:!1,skills:{mysticism:{modifier:0,ranks:0}}}},ctTim:0,ctTimAll:0,customFrameBaseId:"light-freighter",customComponents:[],dedicatedComputerId:"basic-computer",defensiveCountermeasuresId:"none",defensiveCountermeasuresMaterialId:"none",deflectorShieldId:"none",driftEngineId:"none",expansionBayIds:["none","none","none"],fortifiedHullId:"none",frameId:"light-freighter",hasAlgalShielding:0,hasAutoDestruct:0,hasBiometricLocks:0,hasColonyShipFramework:0,hasConsciousnessUplink:0,hasCrew:1,hasDataNet:0,hasEmergencyAccelerator:0,hasHiveJoining:0,hasHolographicMantle:0,hasPowersap:0,hasReconfigurationSystem:0,hasRootSystem:0,hasSelfDestructSystem:0,hasSpaceStationFramework:0,isSetDefaultCrewSkillValues:1,isUseStrictRules:1,powerCoreIds:["none"],powerCoreSpecialMaterials:["none"],ctNetworkNodes:0,reinforcedBulkheadId:"none",roboticAppendageId:"none",secondaryComputerId:"basic-computer",sensorsId:"none",sensorsMaterialId:"none",shieldType:"shields",shieldsByPosition:{forward:0,aft:0,port:0,starboard:0},shieldsId:"none",shipConcept:"",shipName:"",sources:{pw:!0,som:!0},thrustersId:"none",thrustersMaterialId:"none",thrustersBoosterId:"none",thrustersBoosterMaterialId:"none",tierId:"1",version:"1.0.1",viId:"none",viHoloProjectorId:"none",viSkillExpanderId:"none",weaponMounts:{forward:[{weaponId:"none",weight:"light",templateWeight:"light",isFromTemplate:!0,canBeLinked:!1,isLinked:!1,canHaveOrbitalDiscount:!1,hasOrbitalDiscount:!1,specialMaterial:"none"},{weaponId:"none",weight:"light",templateWeight:"light",isFromTemplate:!0,canBeLinked:!1,isLinked:!1,canHaveOrbitalDiscount:!1,hasOrbitalDiscount:!1,specialMaterial:"none"}],aft:[],port:[{weaponId:"none",weight:"light",templateWeight:"light",isFromTemplate:!0,canBeLinked:!1,isLinked:!1,canHaveOrbitalDiscount:!1,hasOrbitalDiscount:!1,specialMaterial:"none"}],starboard:[{weaponId:"none",weight:"light",templateWeight:"light",isFromTemplate:!0,canBeLinked:!1,isLinked:!1,canHaveOrbitalDiscount:!1,hasOrbitalDiscount:!1,specialMaterial:"none"}],turret:[]}},selectSampleShipSortOrder:"name",sources:[{id:"pw",name:"Pact Worlds"},{id:"som",name:"Starship Operations Manual"}]},mounted:function(){},computed:{ablativeArmor:function(){return this.getItemById("ablativeArmor",this.params.ablativeArmorId)},ablativeArmorByPositionTotal:function(){var e=0;for(position in this.params.ablativeArmorByPosition)e+=parseInt(this.params.ablativeArmorByPosition[position]);return e},antiHackingSystems:function(){var e=this.getItemById("antiHackingSystems",this.params.antiHackingSystemsId);return e.getOutputName=function(){var e=this.name.toLowerCase();return"none"!==this.id&&(e+=" (DC +"+this.dcMod+")"),e},e},antiPersonnelWeapon:function(){return this.getItemById("personalWeapon",this.params.antiPersonnelWeaponId)},antiPersonnelWeaponBpCost:function(){return("heavy"==this.antiPersonnelWeapon.type?5:0)+this.antiPersonnelWeapon.level},armor:function(){return this.getItemById("armor",this.params.armorId)},armorBpCost:function(){var e=this.armor.bpCostMultiplier*this.sizeCategory.multiplier;if(this.params.sources.som){var s=0;switch(this.params.armorMaterialId){case"adamantine-alloy":s=this.armor.bpCostMultiplier;break;case"noqual":s=4;break;case"siccatite":s=2}e+=s}return e},armorClass:function(){return 10+this.armor.bonusToAc+this.sizeCategory.acAndTlModifier+this.pilotingRanks+this.deflectorShield.bonusToAc},armorSpecial:function(){var e=[],s="n/a";return isset(this.armor.targetLockModifier)&&this.armor.targetLockModifier<0&&e.push(this.armor.targetLockModifier+" TL"),isset(this.armor.turnDistanceModifier)&&0<this.armor.turnDistanceModifier&&e.push("+"+this.armor.turnDistanceModifier+" turn distance"),0<e.length&&(s=e.join("; ")),s},biometricLocksBpCost:function(){return 5*this.params.hasBiometricLocks},complement:function(){var e=0;for(roleIndex in this.params.crewSkills){var s=this.params.crewSkills[roleIndex];if(s.hasRole){"captain"==roleIndex&&e++;var t=s.countOfficers?parseInt(s.countOfficers):0;e+=t,e+=t*(s.countOfficerCrew?parseInt(s.countOfficerCrew):0)}}return e},computer:function(){return this.getItemById("computer",this.params.computerId)},computerDescription:function(){var e="";if("basic-computer"!==this.computer.id){var s=this.computer.nodes;this.params.sources.som&&this.isSupercolossal&&0<this.networkNodes.ct&&(s+=this.networkNodes.ct),e="+"+this.computer.bonus+" to any "+integerToWord(s)+" check"+(1<s?"s":"")+" per round"}return e},computerCountermeasuresBpCost:function(){var e=0;for(measure in this.params.computerCountermeasures)"shockGridId"==measure?e+=this.shockGridBpCost:1==this.params.computerCountermeasures[measure]&&(e+=this.computerTier);return e},computerCountermeasuresDescription:function(){var e=[];for(measure in this.params.computerCountermeasures)if("shockGridId"==measure){if("none"!==this.params.computerCountermeasures[measure]){var s="shock grid "+this.shockGrid.rank+" [DC "+this.shockGrid.dc+", "+this.shockGrid.damage+"]";e.push(s)}}else if(1==this.params.computerCountermeasures[measure]){var t=this.getItemById("computerCountermeasures",measure).name.toLowerCase();e.push(t)}return e.join(", ")},computerSkillBonusDesc:function(){if(void 0===this.computer.nodes||0==this.computer.nodes)return"+0";for(var e=this,s=[],t=0;t<this.computer.nodes;t++)s.push(e.getPrefixedModifier(e.computer.bonus));if(this.params.sources.som&&"Supercolossal"==this.frame.size)for(t=0;t<this.secondaryComputer.nodes;t++)s.push(e.getPrefixedModifier(e.secondaryComputer.bonus));return s.join("/")},computerTier:function(){var e=this.tier.value;return e<2?1:Math.floor(.5*e)},countPowerCoreHousings:function(){var e=this.sizeCategory.countPowerCoreHousings;return"Medium"!=this.sizeCategory.id&&"Large"!=this.sizeCategory.id||!this.hasPowerCoreHousingExpansionBay||e++,this.adjustPowerCores(e),e},crewQuarters:function(){return this.getItemById("crewQuarters",this.params.crewQuartersId)},crewDescriptions:function(){var r=this,s={};return Object.keys(this.params.crewSkills).forEach(function(t){var e=r.params.crewSkills[t];if(0!=e.hasRole){var i=[];Object.keys(e.skills).forEach(function(e){var s=r.params.crewSkills[t].skills[e];"gunnery"==e&&0==s.modifier||("gunnery"==e||void 0!==s.ranks&&0!=s.ranks)&&i.push(r.getSkillDesc(e,s))}),0<i.length&&(s[t]=i.join(", "))}}),s},criticalThreshold:function(){return Math.round(this.hp/5)+this.fortifiedHull.bonusToCt},ctComputerNodes:function(){var e=0;return e+=this.computer.nodes,this.params.sources.som&&"Supercolossal"==this.frame.size&&(e+=this.secondaryComputer.nodes,e+=this.networkNodes.ct),e},ctExpansionBaySlots:function(){var e=this.frame.expansionBays;return this.params.sources.som&&4<=this.sizeCategory.multiplier&&(this.params.hasColonyShipFramework||this.params.hasSpaceStationFramework)&&(e*=3),e},ctExternalExpansionBays:function(){return this.params.sources.som?this.expansionBays.filter(function(e){return"external-expansion-bay"==e.id}).length:0},customComponentBpTotal:function(){if(!isset(this.params.customComponents))return 0;var s=0;return this.params.customComponents.forEach(function(e){s+=parseInt(e.bpCost)}),s},customComponentPcuTotal:function(){if(!isset(this.params.customComponents))return 0;var s={essential:0,nonEssential:0};return this.params.customComponents.forEach(function(e){e.isEssential?s.essential+=parseInt(e.pcuCost):s.nonEssential+=parseInt(e.pcuCost)}),s},customComponentsDescription:function(){if(0==this.params.customComponents.length)return"None";var s=[];return this.params.customComponents.forEach(function(e){s.push(e.name+(e.notes?" ("+e.notes+")":""))}),s.join("; ")},customFrameSize:function(){return isset(this.params.customFrame)?this.getItemById("sizeCategory",this.params.customFrame.size):{}},damageThreshold:function(){var e=this.frame.dt;return this.params.sources.som&&"adamantine-alloy"==this.params.armorMaterialId&&("n/a"==e&&(e=0),e+=this.armor.bonusToAc),e},dataNetBpCost:function(){return this.params.hasDataNet?3:0},dataNetPcuCost:function(){return this.params.hasDataNet?5:0},dedicatedComputer:function(){return this.getItemById("computer",this.params.dedicatedComputerId)},defensiveCountermeasures:function(){return this.getItemById("defensiveCountermeasures",this.params.defensiveCountermeasuresId)},defensiveCountermeasuresBpCost:function(){var e=this.defensiveCountermeasures.bpCost;if(this.params.sources.som)switch(this.params.defensiveCountermeasuresMaterialId){case"horacalcum":e+=4;break;case"siccatite":e+=3}return e},deflectorShield:function(){return this.getItemById("deflectorShield",this.params.deflectorShieldId)},driftEngine:function(){return this.getItemById("driftEngine",this.params.driftEngineId)},driftEngineBpCost:function(){return this.driftEngine.bpCostMultiplier*this.sizeCategory.multiplier},expansionBays:function(){var s=this,t=[];return this.params.expansionBayIds.forEach(function(e){t.push(s.getItemById("expansionBay",e))}),t},expansionBaysCountUsed:function(){var e=0;for(i in this.expansionBays)"none"!==this.expansionBays[i].id&&(e+=this.expansionBays[i].numBays);return e},expansionBaysDescription:function(){if("Supercolossal"!=this.sizeCategory.id&&0==this.expansionBays.length)return"None";if("Supercolossal"!=this.sizeCategory.id&&0==this.expansionBays.filter(function(e){return"none"!=e.id}).length)return"None";var e={};for(index in this.expansionBays){var s=this.expansionBays[index].id;maybeCreateProperty(e,s,"Integer"),e[s]++}if("Supercolossal"==this.sizeCategory.id){var t=Math.floor(this.frame.bpCost/10);void 0===e["cargo-hold"]&&maybeCreateProperty(e,"cargo-hold","Integer"),e["cargo-hold"]+=t}var i=[];for(id in e)if("none"!=id){var r=this.getItemById("expansionBay",id).name.toLowerCase(),a=e[id],o=r+(1<a?" ("+a+")":"");i.push(o)}return i.join(", ")},expansionBaysTotalBpCost:function(){return this.getSumOfPropertyValuesInCollection(this.expansionBays,"bpCost")},expansionBaysTotalPcuCost:function(){return this.getSumOfPropertyValuesInCollection(this.expansionBays,"pcuCost")},fortifiedHull:function(){var s={},t=this.getItemById("fortifiedHull",this.params.fortifiedHullId);return Object.keys(t).forEach(function(e){s[e]=t[e]}),s.bonusToCt=s.bonusToCtMultiplier*this.sizeCategory.multiplier,s.bpCost=s.bpCostMultiplier*this.sizeCategory.multiplier,s},frame:function(){return"custom"==this.params.frameId?(this.params.customFrame||this.setCustomFrame(),this.params.customFrame):this.getItemById("frame",this.params.frameId)},hasBoosterThrusterHousing:function(){return!!this.params.sources.som&&void 0!==this.expansionBays.find(function(e){return"booster-thruster-housing"==e.id})},hasComputerCountermeasures:function(){for(measure in this.params.computerCountermeasures)if("shockGridId"==measure){if("none"!==this.params.computerCountermeasures[measure])return!0}else if(1==this.params.computerCountermeasures[measure])return!0;return!1},hasDedicatedComputerHousing:function(){return!!this.params.sources.som&&void 0!==this.expansionBays.find(function(e){return"dedicated-computer-housing"==e.id})},hasHealingPod:function(){return!!this.params.sources.som&&void 0!==this.expansionBays.find(function(e){return"healing-pods"==e.id})},hasPowerCoreHousingExpansionBay:function(){var e=!1;for(i in this.params.expansionBayIds)"power-core-housing"==this.params.expansionBayIds[i]&&(e=!0);return e},hasSupercolossalPowerCore:function(){if("Supercolossal"!=this.frame.size)return!1;var s=!1;return this.powerCores.forEach(function(e){s||"none"!=e.id&&-1<e.sizes.indexOf("Supercolossal")&&(s=!0)}),s},hasSecurity:function(){return"none"!==this.params.antiHackingSystemsId||"none"!==this.params.antiPersonnelWeaponId||this.params.hasBiometricLocks||this.hasComputerCountermeasures||this.params.hasSelfDestructSystem||this.params.hasEmergencyAccelerator||this.params.hasHolographicMantle||this.params.hasReconfigurationSystem},hiveJoiningBpCost:function(){return this.params.hasHiveJoining?1:0},hp:function(){return parseInt(this.frame.hp)+parseInt(this.tier.hpIncrease)*this.frame.hpIncrement},isAblativeArmorBalanced:function(){var e=this.params.ablativeArmorByPosition,s=!0;return e.forward==e.aft&&e.forward==e.port&&e.forward==e.starboard||(s=!1),s},isBpCostOverBudget:function(){return this.totalBpCost>this.tier.bpBudget},isComplementValid:function(){var e=!0;return(this.complement<this.frame.minCrew||this.complement>this.frame.maxCrew)&&(e=!1),e},isExpansionBaysCountOverBudget:function(){return this.expansionBaysCountUsed>this.ctExpansionBaySlots},isOrbitalWeaponDiscountUsed:function(){if(!this.params.sources.som)return!1;if(this.sizeCategory.multiplier<4)return!1;if(!this.params.hasColonyShipFramework&&!this.params.hasSpaceStationFramework)return!1;var t=this,i=!1;for(position in this.weaponMounts)this.weaponMounts[position].forEach(function(e,s){i||t.isOrbitalWeapon(e.weapon)&&t.params.weaponMounts[position][s].hasOrbitalDiscount&&(i=!0)});return i},isPcuCostOverBudget:function(){return this.totalPcuCost.essential>this.pcuBudget},isSupercolossal:function(){return this.params.sources.som&&"Supercolossal"==this.frame.size},jsonParams:function(){var e=cloneObject(this.params);return e.isSetDefaultCrewSkillValues=0,JSON.stringify(e)},maneuverabilityRating:function(){return this.params.hasSpaceStationFramework?this.getItemById("maneuverabilityRating","poor"):this.getItemById("maneuverabilityRating",this.frame.maneuverability)},modifiersDescription:function(){var e=[];return"basic-computer"!==this.computer.id&&e.push(this.computerDescription),0!==this.skillModifierComputers&&e.push(this.getPrefixedModifier(this.skillModifierComputers)+" Computers"),0!==this.skillModifierPiloting&&e.push(this.getPrefixedModifier(this.skillModifierPiloting)+" Piloting"),e.join(", ")},networkNodes:function(){var e=0;this.params.sources.som&&this.isSupercolossal&&(e=parseInt(this.params.ctNetworkNodes));return{bpCost:e*this.computer.bonus,ct:e,pcuCost:e*[0,0,0,0,8,10,11,13,15,17,19][0==this.computer.bonus?0:this.computer.bonus-1]}},pilotingRanks:function(){var e=0,s=this.params.crewSkills;return s.pilot.hasRole?e=parseInt(s.pilot.skills.piloting.ranks):s.captain.hasRole?e=parseInt(s.captain.skills.piloting.ranks):"none"!=this.viId&&(e=this.vi.value),e},pcuBudget:function(){var e=0;for(i in this.powerCores){var s=this.powerCores[i].pcuBudget;"abysium"==this.params.powerCoreSpecialMaterials[i]&&(s*=1.25),e+=Math.floor(s)}return e},powerCoreDescription:function(){var e=[];for(i in this.powerCores){var s=this.powerCores[i];"none"!==s.id&&e.push(s.name+" ("+s.pcuBudget+" PCU)")}return e.join(", ")},powerCores:function(){for(i in powerCores=[],this.params.powerCoreIds){var e=cloneObject(this.getItemById("powerCore",this.params.powerCoreIds[i]));if(e.sizeList=e.sizes.join(", "),this.params.sources.som){var s=this.params.powerCoreSpecialMaterials[i],t="";"none"!=s&&(t+=s.toTitleCase()+" "),t+=e.name,e.name=t,"abysium"==s?e.bpCost+=2:"djezet"==s&&(e.bpCost+=1)}powerCores.push(e)}return powerCores},powerCoresBpCost:function(){var e=0;for(i in this.powerCores)e+=this.powerCores[i].bpCost;return e},reinforcedBulkhead:function(){var s={},t=this.getItemById("reinforcedBulkhead",this.params.reinforcedBulkheadId);return Object.keys(t).forEach(function(e){s[e]=t[e]}),s.bpCost=s.bpCostMultiplier*this.sizeCategory.multiplier,s},roboticAppendage:function(){return this.getItemById("roboticAppendage",this.params.roboticAppendageId)},roleDescription:function(){for(role in roleDesc={},this.params.crewSkills){roleDesc[role]=this.getItemById("role",role).name;var e=this.params.crewSkills[role];if(isset(e.countOfficers)&&0<e.countOfficers)if(isset(e.countOfficerCrew)&&0<e.countOfficerCrew){var s=[];s.push(e.countOfficers+" "+"officer".pluralise(e.countOfficers)),s.push(e.countOfficerCrew+" crew"+(1<e.countOfficers?" each":"")),roleDesc[role]+=" ("+s.join(", ")+")"}else 1<e.countOfficers&&("captain"==role?roleDesc[role]+=" (plus "+e.countOfficers+" "+"officer".pluralise(e.countOfficers)+")":roleDesc[role]+=" ("+e.countOfficers+")")}return roleDesc},secondaryComputer:function(){return this.getItemById("computer",this.params.secondaryComputerId)},securityDescription:function(){var e=[];return"none"!==this.params.antiHackingSystemsId&&e.push(this.antiHackingSystems.getOutputName()),"none"!==this.params.antiPersonnelWeaponId&&e.push("anti-personnel weapon ("+this.antiPersonnelWeapon.name.toLowerCase()+")"),this.params.hasBiometricLocks&&e.push("biometric locks"),this.hasComputerCountermeasures&&e.push("computer countermeasures ("+this.computerCountermeasuresDescription+")"),this.params.hasSelfDestructSystem&&e.push("self-destruct system"),this.params.hasEmergencyAccelerator&&e.push("emergency accelerator"),this.params.hasHolographicMantle&&e.push("holographic mantle"),this.params.hasReconfigurationSystem&&e.push("reconfiguration system"),e.join(", ")},securityTotalBpCost:function(){return this.antiHackingSystems.bpCost+this.antiPersonnelWeaponBpCost+this.biometricLocksBpCost+this.computerCountermeasuresBpCost+this.selfDestructSystemBpCost+(this.params.hasEmergencyAccelerator?4*this.sizeCategory.multiplier:0)+(this.params.hasHolographicMantle?12:0)+(this.params.hasReconfigurationSystem?30:0)},securityTotalPcuCost:function(){return(this.params.hasEmergencyAccelerator?5:0)+(this.params.hasHolographicMantle?10:0)+(this.params.hasReconfigurationSystem?50:0)},selectOptions:function(){var t=this,e={},s=["ablativeArmor","antiHackingSystems","armor","computer","computerCountermeasures","crewQuarters","defensiveCountermeasures","deflectorShield","driftEngine","expansionBay","fortifiedHull","frame","personalWeapon","powerCore","reinforcedBulkhead","roboticAppendage","role","sampleShip","shockGrid","sensors","shields","shipWeapon","sizeCategory","skill","thrusters","tier","vi","viHoloProjector","viSkillExpander"];for(i in s){var r=s[i];e[r]=this.getSelectOptionsFor(r)}var a=e.expansionBay.shift();return e.expansionBay.sort(function(e,s){return e.name>s.name}),e.expansionBay.unshift(a),e.sampleShip.sort(function(e,s){return"tier"==t.selectSampleShipSortOrder?stringToFloat(e.tier)>stringToFloat(s.tier):e[t.selectSampleShipSortOrder]>s[t.selectSampleShipSortOrder]}),e.shipWeapon.sort(function(e,s){return e.name>s.name}),e},selfDestructSystemBpCost:function(){return 5*this.params.hasSelfDestructSystem*this.sizeCategory.multiplier},sensors:function(){return this.getItemById("sensors",this.params.sensorsId)},sensorsBpCost:function(){var e=this.sensors.bpCost;if(this.params.sources.som)switch(this.params.sensorsMaterialId){case"djezet":e+=3;break;case"noqual":e+=2}return e},shields:function(){return this.getItemById("shields",this.params.shieldsId)},shieldsByPositionTotal:function(){var e=0;for(position in this.params.shieldsByPosition)e+=parseInt(this.params.shieldsByPosition[position]);return e},shipName:function(){return""==this.params.shipName?"New Ship":this.params.shipName},shockGrid:function(){return this.getItemById("shockGrid",this.params.computerCountermeasures.shockGridId)},shockGridBpCost:function(){return this.shockGrid.bpCostMultiplier*this.computerTier},sizeCategory:function(){return this.getItemById("sizeCategory",this.frame.size)},skillModifierComputers:function(){return this.sensors.modifier},skillModifierPiloting:function(){var e=0;return e+=this.maneuverabilityRating.pilotingModifier,-2<(e+=this.thrusters.pilotingModifier)&&!this.isAblativeArmorBalanced&&(e-=1),this.ablativeArmor.tempHp>this.hp&&(e-=1),e},skillTotals:function(){var e={};for(role in this.params.crewSkills)for(skill in e[role]={},this.params.crewSkills[role].skills){var s=this.params.crewSkills[role].skills[skill];e[role][skill]=parseInt(s.modifier),isset(s.ranks)&&(e[role][skill]+=parseInt(s.ranks)),"computers"==skill&&(e[role][skill]+=this.skillModifierComputers),"piloting"==skill&&(e[role][skill]+=this.skillModifierPiloting)}return e},systemsDescription:function(){var e=[];if(e.push("none"==this.sensors.id?"no sensors":this.sensors.name.toLowerCase()+" sensors"),"none"!==this.params.crewQuartersId&&e.push("crew quarters ("+this.crewQuarters.name.toLowerCase()+")"),"none"!==this.params.armorId){var s=this.armor.name;"none"!=this.params.armorMaterialId&&(s+=" ("+this.getItemById("specialMaterial",this.params.armorMaterialId).name+")"),e.push(s.toLowerCase())}if("none"!==this.params.defensiveCountermeasuresId){var t=this.defensiveCountermeasures.name.toLowerCase();this.params.sources.som&&"none"!=this.params.defensiveCountermeasuresMaterialId&&(t+=" ("+this.getItemById("specialMaterial",this.params.defensiveCountermeasuresMaterialId).name.toLowerCase()+")"),e.push(t)}var i=this.computer.name.toLowerCase()+("basic-computer"==this.computer.id?"":" computer")+" (tier "+this.computerTier+")";if(e.push(i),this.params.sources.som&&this.isSupercolossal&&0<this.networkNodes.ct){var r=("mk "+this.computer.bonus+" network node").pluralise(this.networkNodes.ct);e.push(r+" ("+this.networkNodes.ct+")")}this.params.hasAlgalShielding&&e.push("algal shielding"),this.params.hasAutoDestruct&&e.push("autodestruct"),this.params.hasColonyShipFramework&&e.push("colony ship framework"),this.params.hasConsciousnessUplink&&e.push("consciousness uplink drive"),this.params.hasDataNet&&e.push("data net"),this.params.hasHiveJoining&&e.push("hive joining"),this.params.hasPowersap&&e.push("powersap"),"none"!=this.params.roboticAppendageId&&e.push((this.roboticAppendage.name+" robotic appendage").toLowerCase()),this.params.hasRootSystem&&e.push("root system"),this.params.hasSpaceStationFramework&&e.push("space station framework");var a=parseInt(this.params.ctTim);if(0<a&&e.push((a+" &times; training interface module").pluralise(a)),"none"!=this.params.viId&&e.push("virtual intelligence (tier "+this.vi.name+")"),"none"!=this.params.viSkillExpanderId&&e.push(this.viSkillExpander.name.toLowerCase()+" skill expander"),"none"!=this.params.viHoloProjectorId){var o=this.viHoloProjector.name.toLowerCase()+" holographic projector ["+this.viHoloProjectorSize.toLowerCase()+"]";e.push(o)}return e.join(", ")},targetLock:function(){return 10+this.defensiveCountermeasures.defCMBonusToTl+this.sizeCategory.acAndTlModifier+this.armor.targetLockModifier+this.pilotingRanks+this.ablativeArmor.tlMod+this.deflectorShield.bonusToTl},tempHp:function(){return this.ablativeArmor.tempHp},thrusters:function(){var e=cloneObject(this.getItemById("thrusters",this.params.thrustersId));if(this.params.hasSpaceStationFramework){var s=Math.floor(.25*e.speed);e.speed=s<1?1:s}if(this.params.sources.som)switch(this.params.thrustersMaterialId){case"horacalcum":e.speed++,e.pilotingModifier<0&&e.pilotingModifier++,e.bpCost+=2;break;case"inubrix":e.bpCost+=1}return e},thrustersBooster:function(){var e=cloneObject(this.getItemById("thrusters",this.params.thrustersBoosterId));if(this.params.sources.som)switch(this.params.thrustersBoosterMaterialId){case"horacalcum":e.speed++,e.pilotingModifier<0&&e.pilotingModifier++,e.bpCost+=2;break;case"inubrix":e.bpCost+=1}return e.speed=Math.floor(.25*e.speed),e},tier:function(){return this.getItemById("tier",this.params.tierId)},timBpCost:function(){var e=parseInt(this.params.ctTim);return 2*e+.5*(e*e+e)+3*parseInt(this.params.ctTimAll)},totalBpCost:function(){return parseInt(this.ablativeArmor.bpCost)+(this.params.hasAlgalShielding?5+2*this.sizeCategory.multiplier:0)+parseInt(this.antiHackingSystems.bpCost)+parseInt(this.antiPersonnelWeaponBpCost)+parseInt(this.armorBpCost)+(this.params.hasAutoDestruct?this.sizeCategory.multiplier:0)+parseInt(this.biometricLocksBpCost)+(this.params.hasColonyShipFramework?Math.floor(.25*this.frame.bpCost):0)+parseInt(this.computer.bpCost)+parseInt(this.computerCountermeasuresBpCost)+(this.params.hasConsciousnessUplink?4:0)+parseInt(this.customComponentBpTotal)+parseInt(this.crewQuarters.bpCost)+parseInt(this.dataNetBpCost)+parseInt(this.defensiveCountermeasuresBpCost)+("deflector-shield"==this.params.shieldType?parseInt(this.deflectorShield.bpCost):0)+parseInt(this.driftEngineBpCost)+(this.params.hasEmergencyAccelerator?4*this.sizeCategory.multiplier:0)+parseInt(this.expansionBaysTotalBpCost)+parseInt(this.fortifiedHull.bpCost)+parseInt(this.frame.bpCost)+parseInt(this.hiveJoiningBpCost)+(this.params.hasHolographicMantle?12:0)+(this.isSupercolossal?this.networkNodes.bpCost:0)+parseInt(this.powerCoresBpCost)+(this.params.hasPowersap?3*this.sizeCategory.multiplier:0)+(this.params.hasReconfigurationSystem?30:0)+parseInt(this.reinforcedBulkhead.bpCost)+parseInt(this.roboticAppendage.bpCost)+(this.params.hasRootSystem?2*this.sizeCategory.multiplier:0)+(this.isSupercolossal?this.secondaryComputer.bpCost:0)+parseInt(this.selfDestructSystemBpCost)+parseInt(this.sensorsBpCost)+("shields"==this.params.shieldType?parseInt(this.shields.bpCost):0)+(this.params.hasSpaceStationFramework?Math.floor(.2*this.frame.bpCost):0)+parseInt(this.thrusters.bpCost)+(this.hasBoosterThrusterHousing?parseInt(this.thrustersBooster.bpCost):0)+this.timBpCost+this.vi.bpCost+("none"!=this.params.viId?this.viHoloProjector.bpCost:0)+("none"!=this.params.viId?this.viSkillExpander.bpCost:0)+parseInt(this.weaponsTotalCosts.weaponsBp)+parseInt(this.weaponsTotalCosts.weaponMountsBp)+parseInt(this.weaponsTotalCosts.weaponMaterialsBp)+parseInt(this.weaponsTotalCosts.weaponLinksBp)},totalPcuCost:function(){return{essential:this.thrusters.pcuCost+(this.hasBoosterThrusterHousing?this.thrustersBooster.pcuCost:0)+this.defensiveCountermeasures.pcuCost+("shields"==this.params.shieldType?this.shields.pcuCost:0)+("deflector-shield"==this.params.shieldType?this.deflectorShield.pcuCost:0)+this.weaponsTotalCosts.weaponsPcu+parseInt(this.customComponentPcuTotal.essential)+(this.params.hasEmergencyAccelerator?5:0),nonEssential:this.computer.pcuCost+(this.isSupercolossal?this.secondaryComputer.pcuCost:0)+this.expansionBaysTotalPcuCost+this.dataNetPcuCost+parseInt(this.customComponentPcuTotal.nonEssential)+(this.params.hasHolographicMantle?10:0)+(this.params.hasReconfigurationSystem?50:0)+(this.params.hasRootSystem?5:0)+(this.isSupercolossal?this.networkNodes.bpCost:0)}},turn:function(){return this.maneuverabilityRating.turn+this.armor.turnDistanceModifier+this.ablativeArmor.turnMod+Math.ceil(this.ctExternalExpansionBays/3)},vi:function(){return this.getItemById("vi",this.params.viId)},viCrewDescription:function(){if("none"==this.params.viId)return"";var i=this.getItemById("vi",this.params.viId);if(!i)return"";var r=this,a=[];return["bluff","computers","engineering","gunnery","piloting","sense-motive"].forEach(function(e){var s="gunnery"==e?0:i.value,t="gunnery"==e?i.gunneryMod:i.skillMod-i.value;a.push(r.getSkillDesc(e,{ranks:s,modifier:t}))}),a.join(", ")},viHoloProjector:function(){return this.getItemById("viHoloProjector",this.params.viHoloProjectorId)},viHoloProjectorSize:function(){if("none"==this.params.viHoloProjectorId)return"n/a";var e=this.viHoloProjector.sizeMultiplier;this.sizeCategory.multiplier<this.viHoloProjector.sizeMultiplier&&(e=this.sizeCategory.multiplier);var s=this.getItemByKey("sizeCategory","multiplier",e);return void 0===s?"n/a":void 0===s.name?"n/a":s.name},viSkillExpander:function(){return this.getItemById("viSkillExpander",this.params.viSkillExpanderId)},weaponDescriptions:function(){var e={};for(position in this.weaponMounts){var s=[];for(i in this.weaponMounts[position]){var t=this.weaponMounts[position][i],r=parseInt(i)-1,a="";if((!isset(this.weaponMounts[position][r])||!this.weaponMounts[position][r].isLinked)&&"none"!=t.weapon.id){var o=this.getItemById("specialMaterial",t.specialMaterial),n=(("none"==o.id?"":o.name+" ")+t.weapon.name).toLowerCase();a=t.isLinked?"linked "+n.pluralise(2):n;var p=[];p.push(this.getWeaponDamage(t)),p.push(this.getWeaponRangeNumerical(t.weapon)),0<t.weapon.specialProperties.length&&(p=p.concat(this.getNamesFromIds("weaponSpecialProperty",t.weapon.specialProperties,"").toLowerCase())),t.materialDesc&&p.push(t.materialDesc.toLowerCase()),a+=" ("+p.join(", ")+")",s.push(a)}}0<s.length&&(e[position]=s.join(", "))}return e},weaponMounts:function(){var e={};for(position in this.params.weaponMounts)for(i in e[position]=[],this.params.weaponMounts[position]){var s=cloneObject(this.params.weaponMounts[position][i]);s.weapon=this.getItemById("shipWeapon",s.weaponId),s.position=position,s.sizeCategoryId=this.sizeCategory.id;var t=new WeaponMount(s),r=this.getItemById("shipWeapon",t.weaponId);e[position][i]={weight:s.weight,mountBpCost:t.getCost(),weapon:this.getItemById("shipWeapon",s.weaponId),canBeUpgraded:this.canWeaponMountBeUpgraded(position,s.weight),canBeDowngraded:this.canWeaponMountBeDowngraded(s.weight,s.isFromTemplate,s.templateWeight),isFromTemplate:s.isFromTemplate,isLinked:s.isLinked,specialMaterial:s.specialMaterial,linkCost:s.isLinked?Math.floor(.5*r.bpCost):0,materialCost:t.getMaterialCost(),materialDesc:t.getMaterialDesc(),bpCost:s.hasOrbitalDiscount?Math.floor(s.weapon.bpCost/3):s.weapon.bpCost}}return e},weaponsTotalCosts:function(){var e={weaponLinksBp:0,weaponMountsBp:0,weaponsBp:0,weaponsPcu:0,weaponMaterialsBp:0};for(position in this.weaponMounts)for(i in this.weaponMounts[position]){var s=this.weaponMounts[position][i];e.weaponMountsBp+=s.mountBpCost,e.weaponsBp+=s.bpCost,e.weaponsPcu+=s.weapon.pcuCost,e.weaponLinksBp+=s.linkCost,e.weaponMaterialsBp+=s.materialCost}return e}},methods:{addCustomFrameMount:function(e){isset(this.params.customFrame.mounts[e])||this.$set(this.params.customFrame.mounts,e,[]),this.params.customFrame.mounts[e].push("light"),this.setWeaponMounts(this.frame.mounts)},adjustPowerCores:function(r){var a=this;["powerCoreIds","powerCoreSpecialMaterials"].forEach(function(e){if(a.params[e].length<r)for(var s=a.params[e].length;s<r;s++)a.params[e][s]="none";else if(a.params[e].length>r){var t=r,i=a.params[e].length-r;a.params[e].splice(t,i)}})},canWeaponMountBeCreated:function(e){var s=!0;return this.params.weaponMounts[e].length>=this.sizeCategory.maxMounts&&(s=!1),s},canWeaponMountBeDowngraded:function(e,s,t){var i=!0;if("light"==e)i=!1;else{s&&e==t&&(i=!1)}return i},canWeaponMountBeUpgraded:function(e,s){var t=!0,i={light:0,heavy:1,capital:2};return i[s]>=i[this.sizeCategory.maxMountWeight]?t=!1:"turret"==e?"light"!==s&&(t=!1):"capital"==s&&(t=!1),t},clearAll:function(){this.params=cloneObject(this.paramsReset),this.json="",document.getElementById("sampleShipSelect").value="none"},clearWeaponMounts:function(){for(position in this.params.weaponMounts)this.params.weaponMounts[position].splice(0,this.params.weaponMounts[position].length)},convertJsonInput:function(){var e=JSON.parse(this.json);this.params=e,this.fixMissingParamsValues()},createCustomComponent:function(){isset(this.params.customComponents)||this.$set(this.params,"customComponents",[]),this.params.customComponents.push({name:"",notes:"",isEssential:!1,pcuCost:0,bpCost:0})},createWeaponMount:function(e){this.params.weaponMounts[e].push({weaponId:"none",weight:"light",isFromTemplate:!1,canBeLinked:!1,isLinked:!1,canHaveOrbitalDiscount:!1,hasOrbitalDiscount:!1,specialMaterial:"none"})},destroyWeaponMount:function(e,s){this.params.weaponMounts[e].splice(s,1),this.setWeaponLinking(e)},doesNextMountHaveSameWeaponId:function(e,s){var t=!1,i=parseInt(s)+1,r=this.params.weaponMounts[e];return isset(this.params.weaponMounts[e][i])&&r[s].weaponId==r[i].weaponId&&(t=!0),t},downgradeWeaponMount:function(e,s){var t=this.params.weaponMounts[e][s];"capital"==t.weight?t.weight="heavy":t.weight="light",t.weaponId="none",this.setWeaponLinking(e)},fixMissingCrewSkills:function(){for(roleId in this.paramsReset.crewSkills)if(isset(this.params.crewSkills[roleId]))for(skillId in this.paramsReset.crewSkills[roleId].skills)isset(this.params.crewSkills[roleId].skills[skillId])||(console.log("Missing skill, "+skillId+", in crew role, "+roleId+", added to ship"),this.$set(this.params.crewSkills[roleId].skills,skillId,cloneObject(this.paramsReset.crewSkills[roleId].skills[skillId])));else console.log("Missing crew role, "+roleId+", added to ship"),this.$set(this.params.crewSkills,roleId,cloneObject(this.paramsReset.crewSkills[roleId]))},fixMissingParamsValues:function(){var s=this;for(key in this.paramsReset){"crewSkills"==key&&this.fixMissingCrewSkills();var e=[{id:"specialMaterial",default:"none"},{id:"hasOrbitalDiscount",default:!1}];if("weaponMounts"==key&&isset(this.params.weaponMounts))for(position in this.params.weaponMounts)for(i in this.params.weaponMounts[position])e.forEach(function(e){isset(s.params.weaponMounts[position][i][e.id])||(s.$set(s.params.weaponMounts[position][i],e.id,e.default),console.log("Missing property, "+e.id+", added to "+position+" weapon mount "+(parseInt(i)+1)))});if(!isset(this.params[key])){if(console.log("Missing property, "+key+", added to ship"),this.$set(this.params,key,cloneObject(this.paramsReset[key])),"powerCoreSpecialMaterials"==key)for(i in this.params.powerCoreSpecialMaterials=[],this.params.powerCoreIds)this.params.powerCoreSpecialMaterials.push("none");"shieldsByPosition"==key&&this.setDefaultPositionDependentValues("shields","totalSp"),"armorId"==key&&isset(this.params.armourId)&&(this.params.armorId=this.params.armourId,delete this.params.armourId)}}},getExpansionBayBpCost:function(e){if("quantum-defender"==e.id){var s=4*this.sizeCategory.multiplier,t=s<10?10:s;return e.bpCost=t}return e.bpCost},getExpansionBayPcuCost:function(e){if("quantum-defender"==e.id){var s=5*this.sizeCategory.multiplier,t=s<20?20:s;e.pcuCost=t}return e.pcuCost},getFrameMountWeaponWeight:function(e,s){return this.frame.mounts[e][s]},getItemById:function(e,s){this.testThatPropExists(e);var t=this.data[e].data.find(function(e){return e.id===s});return void 0===t&&(console.log("There is no item "+e+" that matches id "+s),t=this.data[e].data.find(function(e){return"none"===e.id})),t},getItemByKey:function(e,s,t){this.testThatPropExists(e);var i=this.data[e].data.find(function(e){return e[s]===t});return void 0===i&&(console.log("There is no item "+e+" that matches "+s+": "+t),i=this.data[e].data.find(function(e){return"none"===e.id})),i},getNamesFromIds:function(t,e,s){if(!e||0==e.length)return s||"";var i=this,r=[];return e.forEach(function(e){var s=i.getItemById(t,e);r.push(s.name)}),r.join(", ")},getPowerCoreOptionName:function(e){if("none"==e.id)return"None";var s=e.name+" (PCU "+e.pcuBudget+", ";return 1<e.sizes.length?s+=e.sizes[0]+" &ndash; "+e.sizes[e.sizes.length-1]:s+=e.sizes[0],s+=")"},getPowerCoreOptions:function(e){if(void 0===this.params.powerCoreIds[e])return[this.getItemById("powerCore","none")];var s=[];if(!this.params.isUseStrictRules)return this.selectOptions.powerCore;if("Supercolossal"==this.frame.size)return this.getPowerCoreOptionsForSupercolossal(e);var t=this;return this.selectOptions.powerCore.forEach(function(e){-1<e.sizes.indexOf(t.frame.size)&&s.push(e)}),s},getPowerCoreOptionsForSupercolossal:function(e){var s=[];return this.hasSupercolossalPowerCore?"Supercolossal"==this.powerCores[e].sizes[0]?this.selectOptions.powerCore.forEach(function(e){(e.sizes.includes("Colossal")||e.sizes.includes("Supercolossal"))&&s.push(e)}):this.selectOptions.powerCore.forEach(function(e){(e.sizes.includes("Huge")||e.sizes.includes("Gargantuan"))&&s.push(e)}):this.selectOptions.powerCore.forEach(function(e){(e.sizes.includes("Colossal")||e.sizes.includes("Supercolossal"))&&s.push(e)}),s},getPrefixedModifier:function(e){return(0<=e?"+":"")+e},getSampleShipOptionName:function(e){e.name,e.tier;var s={};s="custom"==e.params.frameId?e.params.customFrame:this.getItemById("frame",e.params.frameId);var t=this.getItemById("sizeCategory",s.size);return e.name+" (Tier "+e.tier+" "+t.name+" "+s.name+")"},getSelectOptionsFor:function(e){for(item in this.testThatPropExists(e),this.testThatPropIsArray(e),this.data[e].data)this.testThatItemHasId(e,item),this.testThatItemHasName(e,item);return this.data[e].data},getSkillDesc:function(e,s){if("gunnery"==e&&0==s.modifier)return"";if("gunnery"!=e&&(void 0===s.ranks||0==s.ranks))return"";var t=this.getItemById("skill",e);if(!t)return"";var i=t.name+" ",r=parseInt(s.modifier);return"gunnery"!=e&&(r+=parseInt(s.ranks)),"computers"==e&&(r+=parseInt(this.skillModifierComputers)),"piloting"==e&&(r+=parseInt(this.skillModifierPiloting)),i+=this.getPrefixedModifier(r),"gunnery"!=e&&(i+=" ("+s.ranks+" "+"rank".pluralise(s.ranks)+")"),i},getSumOfPropertyValuesInCollection:function(e,s){var t=0;for(i in e)t+=e[i][s];return t},getWeaponDamage:function(e){if("Special"==e.weapon.damage)return"Special";var s=stringToDice(e.weapon.damage);if("error"===s)return"error";var t=e.isLinked?2:1,i="";return i+=t*s.ctDice,i+="d"+s.ctFaces,0<s.mod&&(i+="+"+t*s.mod),1<s.mult&&(i+="×"+s.mult),i},getWeaponRangeNumerical:function(e){if(void 0===e.range)return"";switch(e.range){case"Short":return"5 hexes";case"Medium":return"10 hexes";case"Long":return"20 hexes";default:return"n/a"}return""},initParams:function(){void 0===window.JTOStarshipSheetModel?this.params=cloneObject(this.paramsReset):this.params=cloneObject(window.JTOStarshipSheetModel)},inputSampleShipParams:function(){var e=document.getElementById("sampleShipSelect").value;if("none"!==e){var s=cloneObject(this.getItemById("sampleShip",e).params);this.params=s,this.fixMissingParamsValues()}},isCrewQuartersOptionAvailable:function(e){return!this.params.isUseStrictRules||(1==this.sizeCategory.multiplier?"none"==e.id:"none"!=e.id)},isCrewRoleAvailable:function(e){return"scr"==e.src||("vi"==e.id&&"none"!=this.params.viId||!!this.params.sources[e.src])},isOrbitalWeapon:function(e){var s=!1;return e.specialProperties.forEach(function(e){s||"orbital"==e.substr(0,7)&&(s=!0)}),s},isWeaponMountLinked:function(e,s){var t=!1;return isset(this.params.weaponMounts[e][s])&&!0===this.params.weaponMounts[e][s].isLinked&&(t=!0),t},maybeAdjustCtTim:function(e){parseInt(this.params.ctTim)>=parseInt(this.params.ctTimAll)||("ctTim"==e&&(this.params.ctTimAll=this.params.ctTim),"ctTimAll"==e&&(this.params.ctTim=this.params.ctTimAll))},maybeCreateExpansionBays:function(e){for(var s=0;s<e;s++)isset(this.params.expansionBayIds[s])||(this.params.expansionBayIds[s]="none")},maybeResetPowerCoreIds:function(i){if("Supercolossal"==this.frame.size){var r=this;this.params.powerCoreIds.forEach(function(e,s){if(s!=i){var t=r.powerCores[s];if(r.hasSupercolossalPowerCore){if(t.sizes.includes("Supercolossal"))return;t.sizes.includes("Huge")||t.sizes.includes("Gargantuan")||(r.params.powerCoreIds[s]="none")}else t.sizes.includes("Colossal")||(r.params.powerCoreIds[s]="none")}})}},popExcessExpansionBays:function(e){var s=this.params.expansionBayIds.length;if(e<s)for(var t=0;t<s-e;t++)this.params.expansionBayIds.pop()},removeCustomComponent:function(e){this.params.customComponents.splice(e,1)},removeCustomFrameMount:function(e,s){this.params.customFrame.mounts[e].splice(s,1),this.params.customFrame.mounts[e].length||this.$delete(this.params.customFrame.mounts,e),this.setWeaponMounts(this.frame.mounts)},resetCustomFrame:function(){this.setCustomFrame(),this.updateFrame()},setCrewQuarters:function(e){"Tiny"==e?"none"!==this.params.crewQuartersId&&(this.params.crewQuartersId="none"):"none"==this.params.crewQuartersId&&(this.params.crewQuartersId="common")},setCustomFrame:function(){this.$set(this.params,"customFrame",cloneObject(this.getItemById("frame",this.params.customFrameBaseId)))},setDefaultCrewSkillValues:function(){if(this.params.isSetDefaultCrewSkillValues){var e=this.getItemById("tier",this.params.tierId).value;for(role in e<1&&(e=1),this.params.crewSkills)for(skill in this.params.crewSkills[role].skills){var s=this.params.crewSkills[role].skills[skill];0<s.ranks&&(s.ranks=e)}}},setDefaultPositionDependentValues:function(e,s){if(isset(this[e]))if(isset(this[e][s]))if(isset(this.params[e+"ByPosition"])){var t=this[e][s],i=[];for(position in this.params[e+"ByPosition"])i.push(position),this.params[e+"ByPosition"][position]=0;for(var r=0;0<t;)this.params[e+"ByPosition"][i[r]]++,t--,r==i.length-1?r=0:r++}else console.log("Missing param: "+e+"ByPosition");else console.log("Missing key in "+e+": "+s);else console.log("Missing computed param: "+e)},setPowerCores:function(){if("Supercolossal"!=this.frame.size)for(var e=0;e<this.countPowerCoreHousings;e++){if(void 0!==this.params.powerCoreIds[e])this.getItemById("powerCore",this.params.powerCoreIds[e]).sizes.includes(this.sizeCategory.name)||(this.params.powerCoreIds[e]="none");else this.params.powerCoreIds[e]="none"}else this.setPowerCoresForSupercolossal()},setComputer:function(){"Supercolossal"==this.frame.size&&this.computer.bonus<4&&(this.params.computerId="mk-4-mononode")},setNetworkNode:function(){"none"!=this.params.networkNodeId&&("Supercolossal"==this.frame.size?this.networkNode.bonus!=this.computer.bonus&&(this.params.networkNodeId="mk"+this.computer.bonus):this.params.networkNodeId)},setPowerCoresForSupercolossal:function(){for(var e=0;e<this.countPowerCoreHousings;e++)if(void 0!==this.params.powerCoreIds[e]){var s=this.getItemById("powerCore",this.params.powerCoreIds[e]);this.hasSupercolossalPowerCore&&"Supercolossal"!=s.sizes[0]?s.sizes.includes("Huge")||s.sizes.includes("Gargantuan")||(this.params.powerCoreIds[e]="none"):s.sizes.includes("Colossal")||s.sizes.includes("Supercolossal")||(this.params.powerCoreIds[e]="none")}else this.params.powerCoreIds[e]="none"},setWeaponLinking:function(e){var s=this.params.weaponMounts[e];for(i in s)"none"===s[i].weaponId||this.isWeaponMountLinked(e,i-1)||this.isWeaponMountLinked(e,parseInt(i)+1)||!this.doesNextMountHaveSameWeaponId(e,i)?(s[i].canBeLinked=!1,s[i].isLinked=!1):s[i].canBeLinked=!0},setWeaponMounts:function(e){this.clearWeaponMounts();var s=["forward","aft","port","starboard","turret","spinal"];for(arcIndex in s){var t=s[arcIndex];if(isset(e[t])){var i=e[t];for(mountIndex in i){var r=i[mountIndex],a={weaponId:"none",weight:r,templateWeight:r,isFromTemplate:!0,canBeLinked:!1,isLinked:!1,canHaveOrbitalDiscount:!1,hasOrbitalDiscount:!1,specialMaterial:"none"};this.params.weaponMounts[t].push(a)}}}},testThatItemHasId:function(e,s){if(!isset(this.data[e].data[s].id))throw"Property "+e+"["+s+"] does not have an id"},testThatItemHasName:function(e,s){if(!isset(this.data[e].data[s].name))throw"Property "+e+"["+s+"] does not have a name"},testThatPropExists:function(e){if(!isset(this.data[e]))throw"Property "+e+" does not exist"},testThatPropIsArray:function(e){if("object"!=typeof this.data[e].data)throw"Property "+e+" is not an array"},updateFrame:function(){this.setCrewQuarters(this.frame.size),this.setWeaponMounts(this.frame.mounts),this.setPowerCores(),this.setComputer(),this.setNetworkNode()},upgradeWeaponMount:function(e,s){var t=this.params.weaponMounts[e][s];"light"==t.weight?t.weight="heavy":t.weight="capital",t.weaponId="none",t.isLinked=!1,this.setWeaponLinking(e)}},beforeMount:function(){this.initParams()}})}function WeaponMount(e){this.doTests=function(){this.testThatPositionIsValid(),this.testThatWeightIsValid(this.weight),this.testThatWeightIsValid(this.templateWeight),this.testThatTemplateWeightIsSmallerThanWeight(),this.testThatTurretIsNotCapital()},this.getCost=function(){return this.getUpgradeCost()+this.getNewMountCost()},this.getMaterialCost=function(){var e=0;switch(this.specialMaterial){case"abysium":case"inubrix":switch(this.weight){case"light":e=2;break;case"heavy":e=6;break;case"capital":case"spinal":e=10}break;case"adamantine-alloy":var s=stringToDice(this.weapon.damage),t=this.isLinked?2:1;e=s.ctFaces*t/2}return e},this.getMaterialDesc=function(){var e=[];switch(this.specialMaterial){case"abysium":switch(this.weight){case"light":e.push("irradiate (low)");break;case"heavy":e.push("irradiate (medium)");break;case"capital":case"spinal":e.push("irradiate (high)")}break;case"adamantine-alloy":var s=stringToDice(this.weapon.damage);void 0!==s.ctDice&&0<s.ctDice&&e.push("+"+s.ctDice+" damage to shieldless quadrants");break;case"inubrix":e.push("20% chance to score second critical hit")}return e.join(", ")},this.getNewMountCost=function(){var e=0;return this.isFromTemplate||(e="turret"==this.position?5:3),e},this.getUpgradeCost=function(){var e=0;return this.weight!==this.templateWeight&&(e=-1!==WEAPON_ARCS.indexOf(this.position)?"light"==this.templateWeight&&"heavy"==this.weight?4:"heavy"==this.templateWeight&&"capital"==this.weight?5:9:6),e},this.testThatPositionIsValid=function(){if(-1==["forward","aft","port","starboard","turret","spinal"].indexOf(this.position))throw"Invalid position in WeaponMount class: "+this.position},this.testThatWeightIsValid=function(e){if(-1==["light","heavy","capital","spinal"].indexOf(e))throw"Invalid weight in WeaponMount class: "+e},this.testThatTemplateWeightIsSmallerThanWeight=function(){var e={light:0,heavy:1,capital:2};if(e[this.weight]<e[this.templateWeight])throw"Original weight must be equal to or lower than current weight"},this.testThatTurretIsNotCapital=function(){if("Supercolossal"!=this.sizeCategoryId&&"turret"==this.position&&("capital"==this.weight||"capital"==this.templateWeight))throw"Turrets cannot have weight 'capital' in WeaponMount"},this.id=e.weaponMountId,this.position=e.position,this.weaponId=e.weaponId,this.weapon=e.weapon,this.weight=e.weight,this.isFromTemplate=e.isFromTemplate,this.isFromTemplate?this.templateWeight=e.templateWeight:this.templateWeight="light",this.canBeLinked=e.canBeLinked,this.isLinked=e.isLinked,this.specialMaterial=e.specialMaterial,this.sizeCategoryId=e.sizeCategoryId,this.doTests()}void 0!==typeof window.Clipboard.name&&"e"==window.Clipboard.name&&(clipboardJson=new Clipboard("#copyJsonBtn",{text:function(e){var s=document.getElementById("outputJson");return addTimedClass(s,"js-anim-border",500),s.innerHTML}})),loadJSON(JSON_FILE,function(e){new Ship(JSON.parse(e))});